<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  >
  <meta
    http-equiv="X-UA-Compatible"
    content="ie=edge"
  >
  <title>Time App - Timer</title>
  <!-- <link rel="stylesheet" href="./assets/style/reset.css"> -->
  <link rel="stylesheet" href="./assets/style/all.css">
</head>

<body>
  <div class="container">
    <header>

      <h1>
        Timer
      </h1>


    </header>

    <main>
      <div class="display-area">

  <div class="time-display">
    <input id="hour" class="time" type="text" value="0" />
    <span>:</span>
    <input id="min" class="time" type="text" value="0" />
    <span>:</span>
    <input id="sec" class="time" type="text" value="0" />
  </div>
  
  <svg class="circle" version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" height="350" width="350" viewBox="0 0 350 350">
    <!-- perimeter: 2 * pi * r => 2 * pi * 155 = 973.893722613 -->
    <circle  fill="transparent" stroke="#333" stroke-width="10" r="155" cx="40" cy="165" transform="rotate(-90 100 100)" stroke-dasharray="974"></circle>
    <circle id="progress-circle" fill="transparent" stroke="orange" stroke-width="10" r="155" cx="40" cy="165" transform="rotate(-90 100 100)" stroke-dasharray="974" stroke-dashoffset="0"></circle>
  </svg>

  <div class="time-input">
    <div class="selection-wrapper">
      <select name="hour" id="hour-select" size="4">
        <option value="0" selected>0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
      </select>
      <span>hours</span>
      <select name="min" id="min-select"  size="4">
        <option value="0" selected>0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>
        <option value="30">30</option>
        <option value="31">31</option>
        <option value="32">32</option>
        <option value="33">33</option>
        <option value="34">34</option>
        <option value="35">35</option>
        <option value="36">36</option>
        <option value="37">37</option>
        <option value="38">38</option>
        <option value="39">39</option>
        <option value="40">40</option>
        <option value="41">41</option>
        <option value="42">42</option>
        <option value="43">43</option>
        <option value="44">44</option>
        <option value="45">45</option>
        <option value="46">46</option>
        <option value="47">47</option>
        <option value="48">48</option>
        <option value="49">49</option>
        <option value="50">50</option>
        <option value="51">51</option>
        <option value="52">52</option>
        <option value="53">53</option>
        <option value="54">54</option>
        <option value="55">55</option>
        <option value="56">56</option>
        <option value="57">57</option>
        <option value="58">58</option>
        <option value="59">59</option>
      </select>
      <span>min</span>
      <select name="sec" id="sec-select"  size="4">
        <option value="0" selected>0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>
        <option value="30">30</option>
        <option value="31">31</option>
        <option value="32">32</option>
        <option value="33">33</option>
        <option value="34">34</option>
        <option value="35">35</option>
        <option value="36">36</option>
        <option value="37">37</option>
        <option value="38">38</option>
        <option value="39">39</option>
        <option value="40">40</option>
        <option value="41">41</option>
        <option value="42">42</option>
        <option value="43">43</option>
        <option value="44">44</option>
        <option value="45">45</option>
        <option value="46">46</option>
        <option value="47">47</option>
        <option value="48">48</option>
        <option value="49">49</option>
        <option value="50">50</option>
        <option value="51">51</option>
        <option value="52">52</option>
        <option value="53">53</option>
        <option value="54">54</option>
        <option value="55">55</option>
        <option value="56">56</option>
        <option value="57">57</option>
        <option value="58">58</option>
        <option value="59">59</option>
      </select>
      <span>sec</span>
    </div>
    
  </div>
</div>

<div class="buttons timer-buttons">
  <button id="cancel" class="active" type="button">Cancel</button>
  <button id="start" class="active" type="button">Start</button>
  <button id="pause" class="" type="button">Pause</button>
</div>

<script>
const svg = document.querySelector('.circle');
const circle = document.querySelector('#progress-circle');
const timeInputModal = document.querySelector('.time-input');
const hourSelect = document.querySelector('#hour-select');
const minSelect = document.querySelector('#min-select');
const secSelect = document.querySelector('#sec-select');
const hourDisplay = document.querySelector('#hour');
const minDisplay = document.querySelector('#min');
const secDisplay = document.querySelector('#sec');
const startBtn = document.querySelector('#start');
const pauseBtn = document.querySelector('#pause');
const cancelBtn = document.querySelector('#cancel');

class Timer {
  constructor(timeSelect, timeDisplay, startBtn, pauseBtn, resetBtn, timeInputModal, svg, callbacks) {
    Object.assign(this, timeSelect);
    Object.assign(this, timeDisplay);
    this.startBtn = startBtn;
    this.pauseBtn = pauseBtn;
    this.cancelBtn = cancelBtn;
    this.timeInputModal = timeInputModal;
    this.svg = svg;

    if (callbacks) {
      this.onStart = callbacks.onStart;
      this.onNext = callbacks.onNext;
      this.onComplete = callbacks.onComplete;
    }

    this.startBtn.addEventListener('click', this.start);
    this.pauseBtn.addEventListener('click', this.pause);
    this.cancelBtn.addEventListener('click', this.cancel);
  }

  timeObjInSecs = () => {
    return (this.timeObj.hour * 60 * 60) + (this.timeObj.min * 60) + this.timeObj.sec;
  }

  start = () => {
    if (this.totalSecs() === 0) {
      console.log('000000')
      alert('Pleas select your time.');
      return;
    }
    this.timeInputModal.classList.add('hidden');
    this.svg.classList.add('active');
    this.startBtn.classList.toggle('active');
    this.pauseBtn.classList.toggle('active');

    if (this.hourDisplay.value === "0" && this.minDisplay.value === "0" && this.secDisplay.value === "0") {
      this.timeObj = {
        hour: parseInt(this.hourSelect.value),
        min: parseInt(this.minSelect.value),
        sec: parseInt(this.secSelect.value)
      }
    } else {
      this.timeObj = {
        hour: parseInt(this.hourDisplay.value),
        min: parseInt(this.minDisplay.value),
        sec: parseInt(this.secDisplay.value)
      }
    }

    if (this.onStart) {
      this.onStart(this.timeObjInSecs(), this.totalSecs());
    }

    this.next();
    this.intervalId = setInterval(this.next, 1000);
  }

  totalSecs = () => {
    return (parseInt(this.hourSelect.value) * 60 * 60) + (parseInt(this.minSelect.value) * 60) + parseInt(this.secSelect.value);
  }

  pause = () => {
    clearInterval(this.intervalId);
    this.startBtn.classList.toggle('active');
    this.pauseBtn.classList.toggle('active');
  }

  next = () => {
    console.log('tick', this.timeObj.hour, ':', this.timeObj.min, ':', this.timeObj.sec )
    // Set display time
    this.hourDisplay.value = this.timeObj.hour;
    this.minDisplay.value = this.timeObj.min;
    this.secDisplay.value = this.timeObj.sec;

    if (this.timeObjInSecs() <= 0) {
      clearInterval(this.intervalId);
      if (this.onComplete) {
        this.onComplete();
        
        this.startBtn.classList.toggle('active');
        this.pauseBtn.classList.toggle('active');
        this.timeInputModal.classList.remove('hidden');
        this.svg.classList.remove('active');

        this.hourDisplay.value = "0";
        this.minDisplay.value = "0";
        this.secDisplay.value = "0";
      }
      return;
    }

    if (this.onNext) {
      this.onNext(this.timeObjInSecs(), this.totalSecs());
    }

    // 24hr => 1440min * 60sec => 86400
    // 1hr => 60min * 60sec => 3600sec
    // 1min => 60sec

    if (this.timeObjInSecs() <= 86400 && this.timeObjInSecs() >= 3600) {
      // > 1hr
      if ( this.timeObj.sec <= 0) {
        // 0sec
        if (this.timeObj.min <= 0) {
          this.timeObj.min = 60;
          this.timeObj.hour--;
        }
        this.timeObj.sec = 60;
        this.timeObj.min--;
      }
      // sec > 0
      this.timeObj.sec--;
    } else if (this.timeObjInSecs() <= 3600 && this.timeObjInSecs() >= 60) {
      //  > 1min & < 1hr
      if (this.timeObjInSecs() === 3600) {
        // sec === 3600sec
        this.timeObj.hour = 0;
        this.timeObj.min = 59;
        this.timeObj.sec = 60;  
      }
      if ( this.timeObj.sec <= 0) {
        this.timeObj.sec = 60;
        this.timeObj.min--;
      }
      this.timeObj.sec--;
    } else {
      // < 1 min
      this.timeObj.sec--;
    }
  }

  cancel = () => {
    clearInterval(this.intervalId);
    this.startBtn.classList.toggle('active');
    this.pauseBtn.classList.toggle('active');
    this.timeInputModal.classList.remove('hidden');
    this.svg.classList.remove('active');

    this.hourDisplay.value = "0";
    this.minDisplay.value = "0";
    this.secDisplay.value = "0";
  }
}

const timer = new Timer(
  {hourSelect, minSelect,secSelect},
  {hourDisplay, minDisplay, secDisplay},
  startBtn,
  pauseBtn,
  cancelBtn,
  timeInputModal,
  svg,
  {
    onStart(currentTimeInSec, totalSecs) {
      const progress = 974 - ((currentTimeInSec / totalSecs) * 974);
      circle.setAttribute('stroke-dashoffset', progress);
    },
    onNext(currentTimeInSec, totalSecs) {
      const progress = 974 - ((currentTimeInSec / totalSecs) * 974);
      circle.setAttribute('stroke-dashoffset', progress);
    },
    onComplete() {
      circle.setAttribute('stroke-dashoffset', 974);
    }
  }
);
</script>
    </main>


    <footer>
      <nav>
        <ul>
          <li>
            <a
              id="index-link"
              href="./index.html"
              class="nav-link"
            />
            <div class="svg-holder">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                aria-hidden="true"
                role="img"
                class="iconify iconify--jam"
                width="32"
                height="32"
                preserveAspectRatio="xMidYMid meet"
                viewBox="0 0 24 24"
              >
                <path
                  d="M4.252 10A8.014 8.014 0 0 0 4 12c0 .69.088 1.36.252 2H7.1a19.83 19.83 0 0 1 0-4H4.252zm.818-2h2.346c.266-1.217.65-2.307 1.121-3.214A8.035 8.035 0 0 0 5.07 8zm14.678 2H16.9a19.83 19.83 0 0 1 0 4h2.848a8.047 8.047 0 0 0 0-4zm-.818-2a8.035 8.035 0 0 0-3.467-3.214c.472.907.855 1.997 1.121 3.214h2.346zm-9.818 2A17.763 17.763 0 0 0 9 12c0 .685.038 1.355.112 2h5.776a17.763 17.763 0 0 0 0-4H9.112zm.358-2h5.06a10.758 10.758 0 0 0-.783-2.177C13.119 4.568 12.447 4 12 4c-.448 0-1.119.568-1.747 1.823c-.315.632-.58 1.367-.783 2.177zm-4.4 8a8.035 8.035 0 0 0 3.467 3.214c-.472-.907-.855-1.997-1.121-3.214H5.07zm13.86 0h-2.346c-.266 1.217-.65 2.307-1.121 3.214A8.035 8.035 0 0 0 18.93 16zm-9.46 0c.203.81.468 1.545.783 2.177C10.881 19.432 11.553 20 12 20c.448 0 1.119-.568 1.747-1.823c.315-.632.58-1.367.783-2.177H9.47zM12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10z"
                  fill="currentColor"
                ></path>
              </svg>
            </div>
            <h3>World Clock</h3>
            </a>
          </li>
          <li>
            <a
              id="alarm-link"
              href="./alarm.html"
              class="nav-link"
            />
            <div class="svg-holder">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                aria-hidden="true"
                role="img"
                class="iconify iconify--jam"
                width="32"
                height="32"
                preserveAspectRatio="xMidYMid meet"
                viewBox="0 0 24 24"
              >
                <path
                  d="M13 12h2a1 1 0 0 1 0 2h-3a1 1 0 0 1-1-1V8a1 1 0 1 1 2 0v4zm7.63-1.562a9 9 0 1 1-17.26 0a5 5 0 1 1 7.668-6.387a9.102 9.102 0 0 1 1.924 0a5 5 0 1 1 7.668 6.387zm-.938-2.113a3 3 0 0 0-4.48-3.735a9.03 9.03 0 0 1 4.48 3.735zM8.787 4.59a3 3 0 0 0-4.48 3.735a9.03 9.03 0 0 1 4.48-3.735zM12 20a7 7 0 1 0 0-14a7 7 0 0 0 0 14z"
                  fill="currentColor"
                ></path>
              </svg>
            </div>
            <h3>Alarm</h3>
            </a>
          </li>
          <li>
            <a
              id="stopwatch-link"
              href="./stopwatch.html"
              class="nav-link"
            />
            <div class="svg-holder">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                aria-hidden="true"
                role="img"
                class="iconify iconify--jam"
                width="32"
                height="32"
                preserveAspectRatio="xMidYMid meet"
                viewBox="0 0 24 24"
              >
                <path
                  d="M13 13h2a1 1 0 0 1 0 2h-3a.997.997 0 0 1-1-1v-4a1 1 0 1 1 2 0v3zM5.869 8.861a1.5 1.5 0 1 1 2.077-1.76a7.967 7.967 0 0 1 1.126-.548A2.5 2.5 0 0 1 10.5 2h3a2.5 2.5 0 0 1 1.428 4.553c.39.154.767.337 1.126.548a1.5 1.5 0 1 1 2.077 1.76a8 8 0 1 1-12.263 0zM12 20a6 6 0 1 0 0-12a6 6 0 0 0 0 12zM10.5 4a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3z"
                  fill="currentColor"
                ></path>
              </svg>
            </div>
            <h3>Stopwatch</h3>
            </a>
          </li>
          <li>
            <a
              id="timer-link"
              href="./timer.html"
              class="nav-link"
            />
            <div class="svg-holder">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                aria-hidden="true"
                role="img"
                class="iconify iconify--mdi"
                width="32"
                height="32"
                preserveAspectRatio="xMidYMid meet"
                viewBox="0 0 24 24"
              >
                <path
                  d="M4.94 6.35c-.39-.39-.39-1.03 0-1.42a.996.996 0 0 1 1.41 0l6.72 5.38l.35.28c.78.78.78 2.05 0 2.83c-.78.78-2.05.78-2.83 0l-.28-.35l-5.37-6.72M12 20a8 8 0 0 0 8-8c0-2.21-.9-4.21-2.34-5.66l1.41-1.41A9.969 9.969 0 0 1 22 12a10 10 0 0 1-10 10A10 10 0 0 1 2 12h2a8 8 0 0 0 8 8m0-19a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2a2 2 0 0 1 2-2z"
                  fill="currentColor"
                ></path>
              </svg>
            </div>
            <h3>Timer</h3>
            </a>
          </li>
        </ul>
      </nav>

    </footer>
  </div>

  <script src="./assets/js/vendors.js"></script>
  <script src="./assets/js/all.js"></script>
</body>

</html>